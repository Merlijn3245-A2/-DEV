<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Downloads</title>
    <link rel="stylesheet" href="style.css" />
</head>
<body>
    <h1>ðŸ“‚ My Downloads ðŸ”¥</h1>

    <!-- README Content -->
    <div id="readme-container">Loading README...</div>

    <!-- Pinned File Links -->
    <div id="pinned-file-list" class="pinned-files">Loading files...</div>

    <!-- Floating RGB Buttons -->
    <div class="floating-buttons">
        <button class="toggle-btn active" onclick="showSection('media')">Media</button>
        <button class="toggle-btn" onclick="showSection('files')">Files</button>
        <button class="toggle-btn" onclick="window.location.href='docs/index.html'">Docs</button>
    </div>

    <!-- Media Section -->
    <div id="media-list"></div>

    <script>
    const repoOwner = "Merlijn3245-A2";
    const repoName = "-DEV";
    const folderPath = "files";
    const pinnedContainer = document.getElementById("pinned-file-list");
    const mediaContainer = document.getElementById("media-list");

    // Load README.md
    fetch(`https://raw.githubusercontent.com/${repoOwner}/${repoName}/main/README.md`)
      .then(res => res.text())
      .then(markdown => {
        document.getElementById("readme-container").innerHTML = marked.parse(markdown);
      })
      .catch(() => {
        document.getElementById("readme-container").textContent = "README could not be loaded.";
      });

    // Load files
    fetch(`https://api.github.com/repos/${repoOwner}/${repoName}/contents/${folderPath}`)
      .then(res => res.json())
      .then(data => {
        pinnedContainer.innerHTML = "";
        mediaContainer.innerHTML = "";
        data.forEach(item => {
          if (item.type === "file") addFile(item.name, item.download_url);
        });
        loadExternalLinks();
        showSection('media');
      })
      .catch(() => {
        pinnedContainer.textContent = "Error loading files.";
        loadExternalLinks();
      });

    function loadExternalLinks() {
      fetch(`https://raw.githubusercontent.com/${repoOwner}/${repoName}/main/links.json?timestamp=${Date.now()}`)
        .then(res => res.json())
        .then(links => {
          links.forEach(link => addExternalLink(link.name, link.url));
        })
        .catch(() => {});
    }

    function addFile(name, url) {
      const ext = name.split('.').pop().toLowerCase();
      if (["png","jpg","jpeg","gif","webp","mp4","webm","ogg","mov"].includes(ext)) {
        const mediaEl = createMediaElement(name, url, ext);
        mediaContainer.appendChild(mediaEl);
      } else {
        const linkEl = createFileLink(name, url);
        pinnedContainer.appendChild(linkEl);
      }
    }

    function addExternalLink(name, url) {
      const linkEl = createFileLink(name, url, true);
      pinnedContainer.appendChild(linkEl);
    }

    function createMediaElement(name, url, ext) {
      if (["png","jpg","jpeg","gif","webp"].includes(ext)) {
        const img = document.createElement("img");
        img.src = url;
        img.alt = name;
        img.className = "embedded-media media";
        return img;
      } else {
        const video = document.createElement("video");
        video.src = url;
        video.controls = true;
        video.className = "embedded-media media";
        return video;
      }
    }

    function createFileLink(name, url, external = false) {
      const a = document.createElement("a");
      a.href = url;
      a.className = "file files";
      if (external) {
        a.target = "_blank";
        a.rel = "noopener noreferrer";
      } else {
        a.download = name;
      }
      a.innerHTML = `${name}`;
      return a;
    }

    function showSection(type) {
        const buttons = document.querySelectorAll('.toggle-btn');
        buttons.forEach(btn => btn.classList.remove('active'));

        if (type === 'media') {
            mediaContainer.style.display = '';
            pinnedContainer.style.display = '';
            buttons[0].classList.add('active');
        } else if (type === 'files') {
            mediaContainer.style.display = 'none';
            pinnedContainer.style.display = '';
            buttons[1].classList.add('active');
        }
    }
    </script>

    <!-- Markdown Parser -->
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
</body>
</html>
