<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Downloads</title>
    <link rel="stylesheet" href="style.css" />
</head>
<body>
    <!-- README Container -->
    <div id="readme-container">
        Loading README...
    </div>

    <div id="downloads-container">
        <div id="files-section">
            <h2>Files</h2>
            <div id="file-list">Loading files...</div>
        </div>
        <div id="media-section">
            <h2>Media</h2>
            <div id="media-list"></div>
        </div>
    </div>

    <script>
    const repoOwner = "Merlijn3245-A2";
    const repoName = "-DEV";
    const folderPath = "files";

    const fileListContainer = document.getElementById("file-list");
    const mediaListContainer = document.getElementById("media-list");

    // Load README from GitHub
    fetch(`https://raw.githubusercontent.com/${repoOwner}/${repoName}/main/README.md`)
      .then(res => res.text())
      .then(md => {
        const readmeContainer = document.getElementById("readme-container");
        readmeContainer.innerHTML = md
          .replace(/^### (.*$)/gim, '<h3>$1</h3>')
          .replace(/^## (.*$)/gim, '<h2>$1</h2>')
          .replace(/^# (.*$)/gim, '<h1>$1</h1>')
          .replace(/\*\*(.*)\*\*/gim, '<strong>$1</strong>')
          .replace(/\*(.*)\*/gim, '<em>$1</em>')
          .replace(/\n/g, '<br />');
      })
      .catch(() => {
        document.getElementById("readme-container").textContent = "README not found.";
      });

    // Load files from GitHub
    fetch(`https://api.github.com/repos/${repoOwner}/${repoName}/contents/${folderPath}`)
      .then(res => res.json())
      .then(data => {
        fileListContainer.innerHTML = "";
        mediaListContainer.innerHTML = "";

        data.forEach(item => {
          if (item.type !== "file") return;

          const ext = item.name.split('.').pop().toLowerCase();
          const isMedia = ["png","jpg","jpeg","gif","webp","mp4","webm","ogg","mov"].includes(ext);

          if (isMedia) {
            addMedia(item.name, item.download_url);
          } else {
            addFile(item.name, item.download_url);
          }
        });

        loadExternalLinks();
      })
      .catch(() => {
        fileListContainer.textContent = "Error loading files.";
        loadExternalLinks();
      });

    function loadExternalLinks() {
      fetch(`https://raw.githubusercontent.com/${repoOwner}/${repoName}/main/links.json?timestamp=${Date.now()}`)
        .then(res => res.json())
        .then(links => {
          links.forEach(link => addFile(link.name, link.url, true));
        })
        .catch(() => {});
    }

    function addFile(name, url, isLink = false) {
      const a = document.createElement("a");
      a.href = url;
      a.className = "file";
      if (isLink) {
        a.target = "_blank";
        a.rel = "noopener noreferrer";
      } else {
        a.download = name;
      }
      a.innerHTML = name;
      fileListContainer.appendChild(a);
    }

    function addMedia(name, url) {
      const ext = name.split('.').pop().toLowerCase();
      if (["png","jpg","jpeg","gif","webp"].includes(ext)) {
        const img = document.createElement("img");
        img.src = url;
        img.alt = name;
        img.className = "embedded-media";
        mediaListContainer.appendChild(img);
      } else {
        const video = document.createElement("video");
        video.src = url;
        video.controls = true;
        video.className = "embedded-media";
        mediaListContainer.appendChild(video);
      }
    }
    </script>
</body>
</html>
